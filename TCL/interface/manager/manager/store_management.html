<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta http-equiv="Pragma" content="no-cache" />
	<meta http-equiv="Cache-Control" content="no-cache" />
	<meta http-equiv="Expires" content="0" />
	<title data-localize="tcl.store.storename"></title>
	<link href="css/style.css" rel="stylesheet" />
	<link href="css/index.css" rel="stylesheet" />
	<script type="text/javascript"  src="http://api.map.baidu.com/api?v=2.0&ak=EE9773cc49eb4a26c15b9e10bd3c9499"></script>
	<script src="https://maps.googleapis.com/maps/api/js?v=3.exp"></script>
	<script src="js/jquery.js" type="text/javascript"></script>
	<script src="js/main.js" type="text/javascript"></script>
	<script src="js/i18n.js" type="text/javascript"></script>
	<script src="js/jquery.localize.js" type="text/javascript" charset="utf-8"></script>
	<script src="js/language_cookie.js" type="text/javascript" charset="utf-8"></script>
</head>
<body>
<!--body部分开始-->
<div class="boader ul_hidden">
  <!--right部分开始-->
	<div  class="right_boader ">
			
		<div class="ul_margin_bottom gaoju">
			<div class="ul_float_left dizhi_add ul_margin_right"  data-localize="tcl.store.address">输入地址:</div>
			<div class="ul_float_left ul_margin_right">
				<div class="select_up">
				<div class="ov_hiden">
					<select class="select_nob" id="country" name="country" onchange="getOption('province');">
						<option value="1">中国</option>
						<option value="2">北美</option>
						<option value="3">菲律宾</option>
						<option value="4">澳洲</option>
					</select>
				</div>
				
			</div>
			</div>
			<div class="ul_float_left ul_margin_right">
				<div class="select_up">
				<div class="ov_hiden">
					<select class="select_nob" id="province" name="province"  onchange="getOption('city');"> 

					</select>
				</div>
				
			</div>
			</div>
			<div class="ul_float_left ul_margin_right">
				<div class="select_up">
				<div class="ov_hiden">
					<select class="select_nob" id="city" name="city">
						<option>请选择</option>
					</select>
				</div>
				
			</div>
			</div>
			<div class="ul_margin_right ul_float_left">
				<span class="span"><input name="" type="text" id="addr" class="inputstyle"></span>
				<div class=" ul_float_left   ul_margin_right" >
							<div class="inpit_font ul_float_right" onclick="search()" data-localize="tcl.store.seach">搜索</div>

				</div>	
			</div>
		</div>
		<div class="ul_margin_bottom ul_hidden">
			<div class="ul_float_left dizhi_add ul_margin_right"  data-localize="tcl.store.post">输入邮编:</div>

			<div class="ul_margin_right ul_float_left">
				<span class="span"><input name="" type="text" class="inputstyle" id="code"></span>
			</div>
		</div>
		<div class="ul_margin_bottom ul_hidden">

			<div class="ul_float_left dizhi_add ul_margin_right"  data-localize="tcl.store.tel">联系电话:</div>
			<div class="ul_margin_right ul_float_left">
				<span class="span"><input name="" type="text" class="inputstyle" id="contactphone"></span>
			</div>
			<div class=" ul_float_left   ul_margin_right" >
							<div class="inpit_font ul_float_right" onclick="addnewAddr()" data-localize="tcl.store.save">保存</div>
				</div>	
			<div class=" ul_float_left   ul_margin_right" >
							<div class="inpit_font ul_float_right" onclick="empty()" data-localize="tcl.store.addname">新增</div>
				</div>	
		</div>
		
		
		<div class="ul_margin_top ditu_img" id="allmap"></div>
		<div class="title_top ul_margin_top" data-localize="tcl.store.file">地址列表</div>
		
		<div class="ul_margin_top">
			<table width="100%" class="table_con shuotu" border="1" id="addrlist"  cellpadding="1" cellspacing="1">
			  <tr>
				<td  width="10%" data-localize="tcl.store.No">序号</td>
				<td width="25%" data-localize="tcl.store.area">地区</td>
				<td width="25%" data-localize="tcl.store.address">地址</td>
				<td width="10%" data-localize="tcl.store.post">邮编</td>
				<td width="10%" data-localize="tcl.store.tel">电话</td>
				<td width="10%" data-localize="tcl.store.gps">位置信息</td>
				<td width="10%" data-localize="tcl.store.Operation">编辑</td>
			  </tr>
			   <!--tr>
				<td>1</td>
				<td  class="ul_padding_left p_top"><span id="region1" class="fenlaned"><input id="region_input1" name="" type="text" value="北京市海淀区" class="inputstyleed ul_text_center" readonly></span></td>
				<td  class="ul_padding_left p_top"><span id="address1" class="fenlaned"><input id="address_input1" name="" type="text" value="中关村大街" class="inputstyleed ul_text_center" readonly></span></td>
				<td  class="ul_padding_left p_top"><span id="postcode1" class="fenlaned"><input id="postcode_input1" name="" type="text" value="1008000" class="inputstyleed ul_text_center" readonly></span></td>
				<td  class="ul_padding_left p_top"><span id="telphone1" class="fenlaned"><input id="telphone_input1" name="" type="text" value="13641163440" class="inputstyleed ul_text_center" readonly></span></td>
				<td  class="ul_padding_left p_top"><span id="positioning1" class="fenlaned"><input id="positioning_input1" name="" type="text" value="是" class="inputstyleed ul_text_center" readonly></span></td>
				<td class="delect_add"><a id="upload1" onclick="upload(1)" class="ul_margin_right" >修改</a><a id="save1" onclick="save(1)" class="ul_display_none">保存</a><a class="ul_margin_right" href="#">删除</a></td>
			  </tr-->
			</table>

		</div>
	</div>
<!--right部分结束-->
</div>
<!--body部分结束-->
</body>
<script>
var maptype=null;
window.onload = function(e){
maptype="baidu";
if(maptype=="baidu")
	initializeBDMap();
getOption("province");
getAddrList();
}

var map=null;
var marker1 =null;
var infoWindow1 = null;
var myGeo = null;
//***********************baidu map***************
function initializeBDMap(){
	// 百度地图API功能
	map = new BMap.Map("allmap");
	map.centerAndZoom(new BMap.Point(116.404, 39.915), 14);
	marker1 = new BMap.Marker(new BMap.Point(116.384, 39.925));  // 创建标注
	map.addOverlay(marker1);              // 将标注添加到地图中
	
	//创建信息窗口
	infoWindow1 = new BMap.InfoWindow("普通标注",{enableMessage:false});
	marker1.addEventListener("click", function(){this.openInfoWindow(infoWindow1);});
	marker1.enableDragging();    //可拖拽
	
	myGeo = new BMap.Geocoder();
}
//***************end baidu map**********
//****************google map**********
var g_map=null;
 var g_marker=null;
 var g_geocoder=null;

function initialize() {
   g_geocoder = new google.maps.Geocoder();
  var myLatlng = new google.maps.LatLng(-25.363882,131.044922);
  var mapOptions = {
    zoom: 4,
    center: myLatlng
  };

  g_map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);

  g_marker = new google.maps.Marker({
      position: myLatlng,
	  draggable:true,
      map: g_map
  });
}

if(maptype=="google")
	google.maps.event.addDomListener(window, 'load', initialize);


function search(){
	var provice = jQuery("#province").find("option:selected").text();
	var city = jQuery("#city").find("option:selected").text();
	var  _addr = jQuery("#addr").val();
	var addr = provice+city+_addr;
	if(maptype=="baidu"){
		 map.clearOverlays();
		myGeo.getPoint(addr, function(point){
		  if (point) {
			map.centerAndZoom(point, 16);
			marker1 = new BMap.Marker(point);
			marker1.enableDragging();    //可拖拽
			map.addOverlay(marker1);
		  }
		}, "");
	}else if(maptype=="google"){
		 g_geocoder.geocode( { 'address': addr}, function(results, status) {
			    if (status == google.maps.GeocoderStatus.OK) {
			      g_map.setCenter(results[0].geometry.location);
			      g_marker = new google.maps.Marker({
			          map: g_map,
					  draggable:true,
			          position: results[0].geometry.location
			      });
			    } else {
			      alert('Geocode was not successful for the following reason: ' + status);
			    }
	  });
	}
	
}
//******************end google map**************
//**************get address list**************

function getAddrList(){
	var country = jQuery("#country").find("option:selected").text();
	jQuery.post(base_url+"storeAddress_list", {country:country}, function(data){
			if(data.status == 0){
				var html="";
				for(var i in data.data){
					html +='<tr id="tr'+data.data[i].id+'"><td>'+data.data[i].id+'</td>'+
						'<td  class="ul_padding_left p_top"><span id="region'+data.data[i].id+'" class="fenlaned"><input id="region_input'+data.data[i].id+'" name="" type="text" value="'+data.data[i].state+data.data[i].city+'" class="inputstyleed ul_text_center" readonly></span></td>'+
						'<td  class="ul_padding_left p_top"><span id="address'+data.data[i].id+'" class="fenlaned"><input id="address_input'+data.data[i].id+'" name="" type="text" value="'+data.data[i].address+'" class="inputstyleed ul_text_center" readonly></span></td>'+
						'<td  class="ul_padding_left p_top"><span id="postcode'+data.data[i].id+'" class="fenlaned"><input id="postcode_input'+data.data[i].id+'" name="" type="text" value="'+data.data[i].postCode+'" class="inputstyleed ul_text_center" readonly></span></td>'+
						'<td  class="ul_padding_left p_top"><span id="telphone'+data.data[i].id+'" class="fenlaned"><input id="telphone_input'+data.data[i].id+'" name="" type="text" value="'+data.data[i].contactPhone+'" class="inputstyleed ul_text_center" readonly></span></td>'+
						'<td  class="ul_padding_left p_top"><span id="positioning'+data.data[i].id+'" class="fenlaned"><input id="positioning_input'+data.data[i].id+'" name="" type="text" value="'+data.data[i].longitude+','+data.data[i].latitude+'" class="inputstyleed ul_text_center" readonly></span></td>'+
					'<td class="delect_add"><a id="upload'+data.data[i].id+'" onclick="upload('+data.data[i].id+')" class="ul_margin_right" >修改</a><a id="save'+data.data[i].id+'" onclick="save('+data.data[i].id+')" class="ul_display_none">保存</a><a class="ul_margin_right"onclick="del('+data.data[i].id+')">删除</a></td></tr>';
				}
					jQuery("#addrlist").append(html);	
			}else{
				alert(data.message);
			}
	   	}, "json");
	
}

//*************end get address list*****************

//***********************end map************
		function getOption(type){
					jQuery("#"+type).empty();
					switch(type){
						case "province":
							//var pid = jQuery("#country").val();
							var pid = 0;
							break;
						case "city":
							var pid = jQuery("#province").val();
							break;
					}
					jQuery.post(base_url+"region_get", {pid:pid}, function(data){
						if(data.status == 0){
							var html = "<option value='0'>请选择</option>";
							for(var i in data.data){
								html += "<option value=\""+data.data[i].id+"\">"+data.data[i].name+"</option>";
							}
							jQuery("#"+type).append(html);
						}else{
							alert(data.message);
						}
				   	}, "json");
			}
			
function upload(id){
	$$('region'+id).className='fenlan';
	$$('address'+id).className='fenlan';
	$$('postcode'+id).className='fenlan';
	$$('telphone'+id).className='fenlan';
	$$('positioning'+id).className='fenlan';
	$$('region_input'+id).readOnly= false;
	$$('address_input'+id).readOnly= false;
	$$('postcode_input'+id).readOnly= false;
	$$('telphone_input'+id).readOnly= false;
	$$('positioning_input'+id).readOnly= false;
	$$('upload'+id).className='ul_display_none';
	$$('save'+id).className='ul_margin_right';
}
function save(id){
	var obj = {id:id,address:$$('address_input'+id).value,postcode:$$('postcode_input'+id).value,telphone:$$('telphone_input'+id).value};
	jQuery.post(base_url+"storeAddress_update",obj , function(data){
			if(data.status == 1){
			       	$$('region'+id).className='fenlaned';
					$$('address'+id).className='fenlaned';
					$$('postcode'+id).className='fenlaned';
					$$('telphone'+id).className='fenlaned';
					$$('positioning'+id).className='fenlaned';
					$$('region_input'+id).readOnly= true;
					$$('address_input'+id).readOnly= true;
					$$('postcode_input'+id).readOnly= true;
					$$('telphone_input'+id).readOnly= true;
					$$('positioning_input'+id).readOnly= true;
					$$('upload'+id).className='ul_margin_right';
					$$('save'+id).className='ul_display_none';
				}else{
					alert(data.message);
				}
	   	}, "json");
}
function del(id){
	jQuery.post(base_url+"storeAddress_del", {id:id}, function(data){
			if(data.status == 1){
			        jQuery("#tr"+id).remove();
				}else{
					alert(data.message);
				}
	   	}, "json");
	   
}
function addnewAddr(){
	var country = jQuery("#country").find("option:selected").text();
	var provice = jQuery("#province").find("option:selected").text();
	var city = jQuery("#city").find("option:selected").text();
	var  _addr = jQuery("#addr").val();
	var addr = provice+city+_addr;
	var code = jQuery("#code").val();
	var contactphone = jQuery("#contactphone").val();
	 var lon = null;
	 var lat = null;
	if(maptype=="baidu"){
	   var p = marker1.getPosition();       //获取marker的位置
	     lon = ""||p.lng;
	     lat = ""||p.lat;
	}
	if(maptype=="google"){
		var p = g_marker.getPosition();       //获取marker的位置
		 lon = ""||p.B;
	     lat = ""||p.K;
	}
	if(jQuery.trim(_addr)==""){
		 alert(i18n.server.addrEmpty);
		 return;
	}
	if(jQuery.trim(code)==""){
		 alert(i18n.server.codeEmpty);
		 return;
	}
	if(jQuery.trim(contactphone)==""){
		 alert(i18n.server.phoneEmpty);
		 return;
	}
	 jQuery.post(base_url+"storeAddress_save",
	   {country:country,
	   state:provice,
	   city:city,
	   postCode:code,
	   address:_addr,
	   phone:contactphone,
	   lon:lon,
	   lat:lat}, 
	   function(data){
				if(data.status == 1){
 						newlow(data.newid);
				}else{
					alert(data.message);
				}
		   	}, "json");
}
function newlow(id){
	var country = jQuery("#country").find("option:selected").text();
	var provice = jQuery("#province").find("option:selected").text();
	var city = jQuery("#city").find("option:selected").text();
	var  _addr = jQuery("#addr").val();
	var addr = provice+city;
	var code = jQuery("#code").val();
	var contactphone = jQuery("#contactphone").val();
	var loc = null;
	if(maptype=="baidu"){
		var tmp = marker1.getPosition();       //获取marker的位置
		ploc = tmp.lng+','+tmp.lat;
	}
	else if(maptype=="google"){
		var tmp = g_marker.getPosition();       //获取marker的位置
		ploc = tmp.B+','+tmp.k;
	}
	

	var tmp='<tr id="tr'+id+'"><td>'+id+'</td>'+
				'<td  class="ul_padding_left p_top"><span id="region'+id+'" class="fenlaned"><input id="region_input'+id+'" name="" type="text" value="'+addr+'" class="inputstyleed ul_text_center" readonly></span></td>'+
				'<td  class="ul_padding_left p_top"><span id="address'+id+'" class="fenlaned"><input id="address_input'+id+'" name="" type="text" value="'+_addr+'" class="inputstyleed ul_text_center" readonly></span></td>'+
				'<td  class="ul_padding_left p_top"><span id="postcode'+id+'" class="fenlaned"><input id="postcode_input'+id+'" name="" type="text" value="'+code+'" class="inputstyleed ul_text_center" readonly></span></td>'+
				'<td  class="ul_padding_left p_top"><span id="telphone'+id+'" class="fenlaned"><input id="telphone_input'+id+'" name="" type="text" value="'+contactphone+'" class="inputstyleed ul_text_center" readonly></span></td>'+
				'<td  class="ul_padding_left p_top"><span id="positioning'+id+'" class="fenlaned"><input id="positioning_input'+id+'" name="" type="text" value="'+loc+'" class="inputstyleed ul_text_center" readonly></span></td>'+
				'<td class="delect_add"><a id="upload'+id+'" onclick="upload('+id+')" class="ul_margin_right" >修改</a><a id="save'+id+'" onclick="save('+id+')" class="ul_display_none">保存</a><a class="ul_margin_right" href="#">删除</a></td></tr>'
			jQuery("#addrlist").append(tmp);	
			empty();	
}
function empty(){
	 jQuery("#addr").val('');
	 jQuery("#code").val('');
	 jQuery("#contactphone").val('');
}
</script>

</html>
